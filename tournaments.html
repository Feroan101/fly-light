<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tournaments - Sky Light Badminton</title>
    <link rel="icon" href="logo.png">
  <link rel="stylesheet" href="styles/styles.css">
  <style>
    body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  margin: 0;
  padding: 0;
  background: #0b1020;
  color: #e5e7eb;
}



/* Container */
.container {
  max-width: 1120px;
  margin: 0 auto;
  padding: 0 20px;
}

/* Hero / Banner */
.page-hero {
  position: relative;
  background: radial-gradient(circle at top left, #1f2937 0, #020617 55%, #000 100%);
  color: white;
  padding: 72px 20px 56px 20px;
  text-align: center;
  overflow: hidden;
}

.page-hero::before {
  content: "";
  position: absolute;
  inset: -40px;
  background:
    radial-gradient(circle at 0% 0%, rgba(56, 189, 248, 0.22), transparent 60%),
    radial-gradient(circle at 100% 0%, rgba(129, 140, 248, 0.18), transparent 55%);
  opacity: 0.9;
  pointer-events: none;
}

.page-hero h1 {
  position: relative;
  margin: 0;
  font-size: 36px;
  font-weight: 700;
  letter-spacing: 0.04em;
}

.page-hero p {
  position: relative;
  margin: 14px 0 0 0;
  font-size: 16px;
  opacity: 0.9;
}

/* Section title */
.section-title {
  font-size: 28px;
  color: #e5e7eb;
  margin: 30px 0 26px 0;
  text-align: center;
  letter-spacing: 0.03em;
}

/* Grid */
.tournaments-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));
  gap: 24px;
  margin-bottom: 60px;
}

/* Cards */
.tournament-card {
  background: radial-gradient(circle at top, #111827 0, #020617 55%);
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 18px 45px rgba(0, 0, 0, 0.65);
  border: 1px solid rgba(148, 163, 184, 0.25);
  transition: transform 0.25s ease, box-shadow 0.25s ease, border-color 0.25s ease;
}

.tournament-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 24px 60px rgba(15, 23, 42, 0.9);
  border-color: rgba(56, 189, 248, 0.5);
}

/* Poster */
.tournament-poster {
  position: relative;
  height: 210px;
  background: linear-gradient(135deg, #6366f1 0%, #0ea5e9 50%, #22c55e 100%);
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 14px;
}

.tournament-poster img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Status pill */
.tournament-status {
  position: absolute;
  top: 10px;
  right: 10px;
  padding: 6px 12px;
  border-radius: 999px;
  font-size: 11px;
  font-weight: 600;
  color: white;
  box-shadow: 0 4px 12px rgba(15, 23, 42, 0.7);
}

.status-scheduled {
  background: #10B981;
}

.status-ongoing {
  background: #FF6B35;
}

.status-completed {
  background: #6B7280;
}

/* Card body */
.tournament-body {
  padding: 16px 18px 18px 18px;
}

.tournament-body h3 {
  margin: 0 0 6px 0;
  color: #e5e7eb;
  font-size: 18px;
  font-weight: 600;
}

.tournament-info {
  color: #9ca3af;
  font-size: 13px;
  line-height: 1.7;
  margin-bottom: 12px;
}

.tournament-info p {
  margin: 1px 0;
}

.tournament-info strong {
  color: #e5e7eb;
}

/* Bracket preview pill */
.bracket-preview {
  margin-top: 8px;
  padding: 7px 10px;
  background: rgba(16, 185, 129, 0.1);
  border-radius: 999px;
  font-size: 12px;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  color: #a7f3d0;
  border: 1px solid rgba(16, 185, 129, 0.4);
}

/* Actions */
.tournament-actions {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}

.btn {
  flex: 1;
  padding: 10px 12px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  font-size: 13px;
  transition: all 0.2s ease;
}

.btn-primary {
  background: linear-gradient(135deg, #10B981, #22c55e);
  color: #022c22;
}

.btn-primary:hover {
  background: linear-gradient(135deg, #059669, #16a34a);
  transform: translateY(-1px);
  box-shadow: 0 8px 18px rgba(16, 185, 129, 0.4);
}

.btn-secondary {
  background: rgba(15, 23, 42, 0.9);
  border: 1px solid rgba(148, 163, 184, 0.6);
  color: #e5e7eb;
}

.btn-secondary:hover {
  background: rgba(30, 64, 175, 0.9);
  border-color: rgba(129, 140, 248, 0.9);
  transform: translateY(-1px);
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Loading + empty state */
.loading {
  text-align: center;
  padding: 40px;
  font-size: 18px;
  color: #9ca3af;
}

.empty-state {
  text-align: center;
  padding: 80px 20px;
  color: #9ca3af;
}

.empty-state h2 {
  color: #e5e7eb;
  margin-bottom: 10px;
}

/* Footer */
.footer {
  background: #020617;
  color: #9ca3af;
  text-align: center;
  padding: 26px 0;
  margin-top: 40px;
  font-size: 13px;
  border-top: 1px solid rgba(148, 163, 184, 0.2);
}

/* Modal */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(15, 23, 42, 0.9);
  z-index: 1000;
  align-items: center;
  justify-content: center;
}

.modal.active {
  display: flex;
}

.modal-content {
  background: #020617;
  padding: 24px 24px 26px 24px;
  border-radius: 14px;
  max-width: 420px;
  width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 24px 80px rgba(0, 0, 0, 0.9);
  border: 1px solid rgba(148, 163, 184, 0.35);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.modal-header h2 {
  margin: 0;
  color: #e5e7eb;
  font-size: 18px;
}

.modal-close {
  background: none;
  border: none;
  font-size: 22px;
  cursor: pointer;
  color: #9ca3af;
}

.modal-close:hover {
  color: #e5e7eb;
}

.form-group {
  margin-bottom: 14px;
}

.form-group label {
  display: block;
  margin-bottom: 5px;
  font-weight: 600;
  color: #e5e7eb;
  font-size: 13px;
}

.form-group input,
.form-group select {
  width: 100%;
  padding: 9px 10px;
  border: 1px solid #4b5563;
  border-radius: 8px;
  font-size: 13px;
  font-family: inherit;
  background: #020617;
  color: #e5e7eb;
}

.form-group input:focus,
.form-group select:focus {
  outline: none;
  border-color: #10B981;
  box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.3);
}

/* Alerts */
.alert {
  padding: 12px;
  border-radius: 8px;
  margin-bottom: 16px;
  font-size: 13px;
}

.alert-success {
  background: rgba(16, 185, 129, 0.12);
  color: #bbf7d0;
  border: 1px solid rgba(16, 185, 129, 0.6);
}

.alert-error {
  background: rgba(248, 113, 113, 0.12);
  color: #fecaca;
  border: 1px solid rgba(248, 113, 113, 0.6);
}

.alert-info {
  background: rgba(59, 130, 246, 0.12);
  color: #bfdbfe;
  border: 1px solid rgba(59, 130, 246, 0.6);
}

/* Mobile tweaks */
@media (max-width: 768px) {
  .navbar h1 {
    font-size: 18px;
  }

  .navbar a {
    margin-left: 12px;
    font-size: 12px;
  }

  .page-hero {
    padding: 64px 18px 46px 18px;
  }

  .page-hero h1 {
    font-size: 28px;
  }

  .page-hero p {
    font-size: 14px;
  }

  .section-title {
    font-size: 22px;
    margin-top: 24px;
  }

  .tournaments-grid {
    grid-template-columns: 1fr;
    gap: 18px;
  }

  .tournament-poster {
    height: auto;
  }

  .tournament-poster img {
    width: 100%;
    height: auto;
    display: block;
  }

  .tournament-body {
    padding: 14px 14px 16px 14px;
  }

  .tournament-actions {
    flex-direction: column;
  }
}


  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar" id="navbar">
        <div class="nav-container">
            <div class="nav-logo">
  <img src="logo.png" alt="fly Light Academy Logo" style="height:60px; vertical-align:middle;">
</div>

            <div class="hamburger" id="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <ul class="nav-menu" id="nav-menu">
                <li><a href="index.html" class="active">Home</a></li>
                <li><a href="achievements.html">Achievements</a></li>
                <li><a href="gallery.html">Gallery</a></li>
                
                <li><a href="index.html#contact">Contact</a></li>
            </ul>
        </div>
    </nav>

  <!-- Page Hero -->
  <section class="page-hero">
    <h1>Join Our Tournaments</h1>
  </section>

  <!-- Main Content -->
  <section style="padding: 80px 0;">
    <div class="container">
      <h2 class="section-title">Available Tournaments</h2>
      <div id="tournaments-container" class="tournaments-grid"></div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <p>&copy; 2025 Sky Light Badminton Academy. All rights reserved.</p>
  </footer>

  <!-- Join Modal -->
  <div id="join-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Join Tournament</h2>
        <button class="modal-close" onclick="closeModal('join-modal')">√ó</button>
      </div>
      <form id="join-form" onsubmit="submitJoinForm(event)">
        <div class="form-group">
          <label>Full Name *</label>
          <input type="text" name="name" required>
        </div>
        <div class="form-group">
          <label>Phone Number *</label>
          <input type="tel" name="phone" required>
        </div>
        <div class="form-group">
          <label>Email *</label>
          <input type="email" name="email" required>
        </div>
        <div class="form-group">
          <label>Academy Name</label>
          <input type="text" name="academy_name">
        </div>
        <div class="form-group">
          <label>Select Venue *</label>
          <select name="selected_venue" required>
            <option value="">Choose venue...</option>
            <option value="Main Venue">Main Venue</option>
            <option value="Secondary Venue">Secondary Venue</option>
            <option value="Online">Online</option>
          </select>
        </div>
        <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">Proceed to Payment</button>
      </form>
    </div>
  </div>

  <!-- Scripts -->
  <script src="js/script.js"></script>
  <script src="js/db.js"></script>
  <script src="js/tournaments-user.js"></script>
  <script>
    // Override to add modal handling
    let currentTournamentId = null;
    const API_URL = 'https://fly-light.onrender.com/';

    function joinTournament(tournamentId) {
      currentTournamentId = tournamentId;
      openModal('join-modal');
    }

    function openModal(id) {
      document.getElementById(id).classList.add('active');
    }

    function closeModal(id) {
      document.getElementById(id).classList.remove('active');
    }

    function submitJoinForm(e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);

      const data = {
        name: formData.get('name'),
        phone: formData.get('phone'),
        email: formData.get('email'),
        academy_name: formData.get('academy_name'),
        selected_venue: formData.get('selected_venue')
      };

      fetch(`${API_URL}api/tournaments/${currentTournamentId}`)
        .then(r => r.json())
        .then(tournament => {
          return fetch(`${API_URL}api/tournaments/${currentTournamentId}/join`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });
        })
        .then(r => r.json())
        .then(res => {
          sessionStorage.setItem('pendingRegistration', JSON.stringify({
            registration_id: res.registration_id,
            tournament_id: currentTournamentId,
            amount: 500,
            user_email: data.email,
            reference_type: 'tournament'
          }));
          window.location.href = 'payment.html';
        })
        .catch(err => {
          alert('Error: ' + err.message);
        });
    }

    // Override displayTournaments to use modal
    const originalDisplayTournaments = displayTournaments;
    function displayTournaments(tournaments) {
        const container = document.getElementById('tournaments-container');
        
        if (tournaments.length === 0) {
          container.innerHTML = '<div class="empty-state" style="grid-column: 1/-1;"><h2>No tournaments available</h2><p>Check back soon for upcoming tournaments!</p></div>';
          return;
        }

        let html = '';
        tournaments.forEach(tournament => {
          const startDate = new Date(tournament.start_date).toLocaleDateString('en-IN');
          const endDate = new Date(tournament.end_date).toLocaleDateString('en-IN');
          // Decide status purely from accept_entries
          const isAccepting = tournament.accept_entries;
          const statusText = isAccepting ? 'SCHEDULED' : 'ONGOING';
          const statusClass = isAccepting ? 'status-scheduled' : 'status-ongoing';
          
          // ‚úÖ Add bracket preview if exists
          let bracketPreview = '';
          if (tournament.bracket_data) {
            try {
              const bracketData = typeof tournament.bracket_data === 'string'
                ? JSON.parse(tournament.bracket_data)
                : tournament.bracket_data;
              
              if (bracketData && Array.isArray(bracketData) && bracketData.length > 0) {
                const totalPlayers = bracketData[0]?.length * 2 || 0;
                bracketPreview = `
                  <div class="bracket-preview" style="margin-top: 8px; padding: 8px; background: rgba(58, 169, 255, 0.1); border-radius: 6px; font-size: 13px;">
                    üìä Bracket Ready: ${totalPlayers} players, ${bracketData.length} rounds
                  </div>
                `;
              }
            } catch (e) {
              console.log('Bracket preview parse error:', tournament.name);
            }
          }

          const posterSrc = tournament.poster_url
            ? `${API_URL}${tournament.poster_url}`
            : 'img/default.jpg';

          html += `
            <div class="tournament-card">
              <div class="tournament-poster">
                <img src="${posterSrc}" alt="${tournament.name}">
                <div class="tournament-status ${statusClass}">${statusText}</div>
              </div>
              <div class="tournament-body">
                <h3>${tournament.name}</h3>
                <div class="tournament-info">
                  <p><strong>üìç Venue:</strong> ${tournament.venue}</p>
                  <p><strong>üìÖ Dates:</strong> ${startDate} to ${endDate}</p>
                  <p><strong>üí∞ Price:</strong> ‚Çπ${tournament.price}</p>
                  <p><strong>üë• Capacity:</strong> ${tournament.capacity} players</p>
                  ${bracketPreview}
                </div>
                <div class="tournament-actions"> 
                  <button class="btn btn-secondary" onclick="window.location.href = 'tournament-details.html?id=${tournament.id}'">
                    View Details
                  </button>
                  ${tournament.status !== 'completed' && tournament.accept_entries ? 
                    `<button class="btn btn-primary" onclick="joinTournament('${tournament.id}')">Join</button>` : ''
                  }
                </div>
              </div>
            </div>
          `;
        });

        container.innerHTML = html;
      }


    function viewDetails(tournamentId, gmapsLink) {
      if (gmapsLink) {
        window.open(gmapsLink, '_blank');
      } else {
        alert('No location details available');
      }
    }
  </script>
</body>
</html>
